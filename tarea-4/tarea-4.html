<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regularización L1 y L2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="tarea-4_files/libs/clipboard/clipboard.min.js"></script>
<script src="tarea-4_files/libs/quarto-html/quarto.js"></script>
<script src="tarea-4_files/libs/quarto-html/popper.min.js"></script>
<script src="tarea-4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="tarea-4_files/libs/quarto-html/anchor.min.js"></script>
<link href="tarea-4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tarea-4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="tarea-4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="tarea-4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="tarea-4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Regularización L1 y L2</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>En este ejemplo hacemos <em>análisis de sentimiento</em>, intentanto predecir si reseñas de películas son positivas o negativas a partir del texto de las reseñas. En este ejemplo veremos un enfoque relativamente simple, que consiste en considerar solamente las palabras que contienen las reseñas, sin tomar en cuenta el orden (el modelo de bolsa de palabras o <em>bag of words</em>).</p>
<p>Usaremos regresión lineal, aunque este tipo de problema es mejor resolverlo usando algún método para variables binarias o categóricas (regresión logística por ejemplo)</p>
<section id="feature-engineering-básico" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering-básico">Feature engineering básico</h2>
<p>Hay muchas maneras de preprocesar los datos para obtener variables numéricas a partir del texto. En este caso simplemente tomamos las palabras que ocurren más frecuentemente.</p>
<ul>
<li>Encontramos las 3000 palabras más frecuentes sobre todos los textos, por ejemplo. Estas palabras son nuestro <strong>vocabulario</strong>.</li>
<li>Registramos en qué documentos ocurre cada una de esas palabras.</li>
<li>Cada palabra es una columna de nuestros datos, el valor es 1 si la palabra ocurre en documento y 0 si no ocurre.</li>
</ul>
<p>Por ejemplo, para el texto “Un gato blanco, un gato negro”, “un perro juega”, “un astronauta juega” quedarían los datos:</p>
<table class="table">
<thead>
<tr class="header">
<th>texto_id</th>
<th>un</th>
<th>gato</th>
<th>negro</th>
<th>blanco</th>
<th>perro</th>
<th>juega</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>texto_1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>texto_2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>texto_3</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Nótese que la palabra <em>astronauta</em> no está en nuestro vocabulario para este ejemplo.</p>
<p>Hay varias opciones para tener mejores variables, que pueden o no ayudar en este problema (no las exploramos en este ejercicio):</p>
<ul>
<li>Usar conteos de frecuencias de ocurrencia de palabras en cada documento, o usar log(1+ conteo), en lugar de 0-1’s</li>
<li>Usar palabras frecuentes, pero quitar las que son <em>stopwords</em>, como son preposiciones y artículos entre otras, pues no tienen significado: en inglés, por ejemplo, <em>so, is, then, the, a</em>, etc.</li>
<li>Lematizar palabras: por ejemplo, contar en la misma categoría <em>movie</em> y <em>movies</em>, o <em>funny</em> y <em>funniest</em>, etc.</li>
<li>Usar indicadores binarios si la palabra ocurre o no en lugar de la frecuencia</li>
<li>Usar frecuencias ponderadas por qué tan rara es una palabra sobre todos los documentos (frecuencia inversa sobre documentos)</li>
<li>Usar pares de palabras en lugar de palabras sueltas: por ejemplo: juntar “not” con la palabra que sigue (en lugar de usar <em>not</em> y <em>bad</em> por separado, juntar en una palabra <em>not_bad</em>),</li>
<li>Usar técnicas de reducción de dimensionalidad que considera la co-ocurrencia de palabras (veremos más adelante en el curso).</li>
<li>Muchas otras</li>
</ul>
<section id="datos" class="level3">
<h3 class="anchored" data-anchor-id="datos">Datos</h3>
<p>Los textos originales los puedes encontrarlos en la carpeta <em>datos/sentiment</em>. Están en archivos individuales que tenemos que leer. Podemos hacer lo que sigue:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># puedes necesitar el siguiente paquete</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("textrecipes")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("stopwords")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>nombres_neg <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"./datos/sentiment/neg"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>nombres_pos <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"./datos/sentiment/pos"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># positivo</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>textos_pos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">texto =</span> <span class="fu">map_chr</span>(nombres_pos, read_file), <span class="at">polaridad =</span> <span class="st">"pos"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>textos_neg <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">texto =</span> <span class="fu">map_chr</span>(nombres_neg, read_file), <span class="at">polaridad =</span> <span class="st">"neg"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>textos <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(textos_pos, textos_neg) <span class="sc">|&gt;</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">polaridad_num =</span> <span class="fu">ifelse</span>(polaridad <span class="sc">==</span> <span class="st">"pos"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>polaridad)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(textos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(textos<span class="sc">$</span>polaridad_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   0    1 
1000 1000 </code></pre>
</div>
</div>
<p>Y un fragmento del primer texto:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(textos<span class="sc">$</span>texto[[<span class="dv">5</span>]], <span class="dv">1</span>, <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "moviemaking is a lot like being the general manager of an nfl team in the post-salary cap era -- you've got to know how to allocate your resources . \nevery dollar spent on a free-agent defensive tackle is one less dollar than you can spend on linebackers or safeties or centers . \nin the nfl , this l"</code></pre>
</div>
</div>
<p>Antes de definir la receta y explorar, separamos muestra de entrenamiento y validación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3189</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacemos un split de validación porque más adelante lo usaremos</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># para seleccionar modelos</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>textos_split <span class="ot">&lt;-</span> <span class="fu">validation_split</span>(textos, <span class="at">prop =</span> <span class="fl">0.85</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>textos_ent <span class="ot">&lt;-</span> <span class="fu">analysis</span>(textos_split<span class="sc">$</span>splits[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Construimos nuestra receta con el feature engineering explicado arriba:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("textrecipes")</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("stopwords")</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>receta_polaridad <span class="ot">&lt;-</span> <span class="fu">recipe</span>(polaridad_num <span class="sc">~</span> ., textos_ent) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">texto =</span> <span class="fu">str_remove_all</span>(texto, <span class="st">"[_()]"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">texto =</span> <span class="fu">str_remove_all</span>(texto, <span class="st">"[0-9]*"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenize</span>(texto) <span class="sc">|&gt;</span> <span class="co"># separar por palabras</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_stopwords</span>(texto) <span class="sc">|&gt;</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenfilter</span>(texto, <span class="at">max_tokens =</span> <span class="dv">6000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tf</span>(texto, <span class="at">weight_scheme =</span> <span class="st">"binary"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.logical), as.numeric))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># en el prep se separa en palabras, se eliminan stopwords,</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># se filtran los de menor frecuencia y se crean las variables</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 - 1 que discutimos arriba, todo con los textos de entrenamiento</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>receta_prep <span class="ot">&lt;-</span> receta_polaridad <span class="sc">|&gt;</span> <span class="fu">prep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Los términos seleccionados (el vocabulario) están aquí (una muestra)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>receta_prep<span class="sc">$</span>term_info <span class="sc">|&gt;</span> <span class="fu">sample_n</span>(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 4
   variable          type    role      source 
   &lt;chr&gt;             &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  
 1 tf_texto_guilt    numeric predictor derived
 2 tf_texto_robert   numeric predictor derived
 3 tf_texto_harold   numeric predictor derived
 4 tf_texto_hence    numeric predictor derived
 5 tf_texto_troubled numeric predictor derived
 6 tf_texto_blast    numeric predictor derived
 7 tf_texto_manic    numeric predictor derived
 8 tf_texto_myers    numeric predictor derived
 9 tf_texto_owes     numeric predictor derived
10 tf_texto_paltrow  numeric predictor derived
# … with 20 more rows</code></pre>
</div>
</div>
<p>El tamaño de la matriz que usaremos tiene 1700 renglones (textos) por 6001 columnas de términos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mat_textos_entrena <span class="ot">&lt;-</span> <span class="fu">juice</span>(receta_prep)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mat_textos_entrena)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1700 6001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mat_textos_entrena)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6,001
  polaridad_num tf_tex…¹ tf_te…² tf_te…³ tf_te…⁴ tf_te…⁵ tf_te…⁶ tf_te…⁷ tf_te…⁸
          &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1             1        0       0       0       0       0       0       0       0
2             0        0       0       0       0       0       0       0       0
3             1        0       0       0       0       0       0       0       0
4             1        0       0       0       0       0       0       0       0
5             0        0       0       0       0       0       0       0       0
6             1        0       0       0       0       1       0       0       0
# … with 5,992 more variables: tf_texto_absent &lt;dbl&gt;, tf_texto_absolute &lt;dbl&gt;,
#   tf_texto_absolutely &lt;dbl&gt;, tf_texto_absorbed &lt;dbl&gt;,
#   tf_texto_absorbing &lt;dbl&gt;, tf_texto_absurd &lt;dbl&gt;, tf_texto_abuse &lt;dbl&gt;,
#   tf_texto_abusive &lt;dbl&gt;, tf_texto_abyss &lt;dbl&gt;, tf_texto_academy &lt;dbl&gt;,
#   tf_texto_accent &lt;dbl&gt;, tf_texto_accents &lt;dbl&gt;, tf_texto_accept &lt;dbl&gt;,
#   tf_texto_acceptable &lt;dbl&gt;, tf_texto_acceptance &lt;dbl&gt;,
#   tf_texto_accepted &lt;dbl&gt;, tf_texto_accepting &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
</section>
<section id="clasificador-de-textos" class="level2">
<h2 class="anchored" data-anchor-id="clasificador-de-textos">Clasificador de textos</h2>
<p>Ahora hacemos regresión lineal con regularización ridge/lasso (aunque este es un problema que podríamos tratar mejor con regresión logística). La penalización es de la forma</p>
<p><span class="math display">\[\lambda((1-\alpha) \sum_j \beta_j^2 + \alpha \sum_j |\beta_j|)\]</span></p>
<p>de manera que combina ventajas de ridge (encoger juntos parámetros de variables correlacionadas) y lasso (eliminar variables que aportan poco a la predicción).</p>
<p>Calcula el rmse del un modelo con regularización baja (por ejemplo, <span class="math inline">\(\log(\lambda) = -10\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>modelo_baja_reg <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">mixture =</span> <span class="fl">0.5</span>, <span class="at">penalty =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">10</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_args</span>(<span class="at">lambda.min.ratio =</span> <span class="dv">0</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>flujo_textos <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(receta_polaridad) <span class="sc">|&gt;</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(modelo_baja_reg) <span class="sc">|&gt;</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(textos_ent)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>textos_pr <span class="ot">&lt;-</span> <span class="fu">assessment</span>(textos_split<span class="sc">$</span>splits[[<span class="dv">1</span>]])</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>preds_baja_reg_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(flujo_textos, textos_pr) <span class="sc">|&gt;</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(textos_pr <span class="sc">|&gt;</span> <span class="fu">select</span>(polaridad_num))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>preds_baja_reg_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(flujo_textos, textos_ent) <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(textos_ent <span class="sc">|&gt;</span> <span class="fu">select</span>(polaridad_num))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>rmse_baja_reg <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(preds_baja_reg_train <span class="sc">|&gt;</span> <span class="fu">rmse</span>(polaridad_num, .pred) <span class="sc">|&gt;</span> <span class="fu">select</span>(.estimate), preds_baja_reg_test <span class="sc">|&gt;</span> <span class="fu">rmse</span>(polaridad_num, .pred) <span class="sc">|&gt;</span> <span class="fu">select</span>(.estimate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `.estimate` -&gt; `.estimate...1`
• `.estimate` -&gt; `.estimate...2`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rmse_baja_reg) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rmse_train"</span>, <span class="st">"rmse_test"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>rmse_baja_reg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  rmse_train rmse_test
       &lt;dbl&gt;     &lt;dbl&gt;
1     0.0151     0.443</code></pre>
</div>
</div>
<p>Selecciona ahora un modelo con regularización mayor:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>modelo_mas_reg <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">mixture =</span> <span class="fl">0.5</span>, <span class="at">penalty =</span> <span class="fl">0.05</span>) <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_args</span>(<span class="at">lambda.min.ratio =</span> <span class="fl">1e-20</span>) </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>flujo_textos_alta <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(receta_polaridad) <span class="sc">|&gt;</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(modelo_mas_reg) <span class="sc">|&gt;</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(textos_ent)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>preds_alta_reg_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(flujo_textos_alta, textos_pr) <span class="sc">|&gt;</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(textos_pr <span class="sc">|&gt;</span> <span class="fu">select</span>(polaridad_num)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>preds_alta_reg_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(flujo_textos, textos_ent) <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(textos_ent <span class="sc">|&gt;</span> <span class="fu">select</span>(polaridad_num))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>rmse_alta_reg <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(preds_alta_reg_train <span class="sc">|&gt;</span> <span class="fu">rmse</span>(polaridad_num, .pred) <span class="sc">|&gt;</span> <span class="fu">select</span>(.estimate), preds_alta_reg_test <span class="sc">|&gt;</span> <span class="fu">rmse</span>(polaridad_num, .pred) <span class="sc">|&gt;</span> <span class="fu">select</span>(.estimate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `.estimate` -&gt; `.estimate...1`
• `.estimate` -&gt; `.estimate...2`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rmse_alta_reg) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rmse_train"</span>, <span class="st">"rmse_test"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>rmse_alta_reg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  rmse_train rmse_test
       &lt;dbl&gt;     &lt;dbl&gt;
1     0.0151     0.396</code></pre>
</div>
</div>
<p><strong>Pregunta 1</strong>: ¿Qué modelo se desempeña mejor? ¿Cuál está más sobreajustado? ¿Qué cosas podrías considerar para reducir el sesgo (piensa qué nuevas entradas podrías construir)?</p>
<p>Ambos modelos tienen el mismo desempeño sobre el conjunto de entrenamiento, sin embargo sobre el conjunto de prueba el que se desempeña mejor es el modelo con <strong>mayor regularización</strong>. Podemos decir que el modelo que está más sobreajustado es el modelo con menor penalización, ya que los coeficientes tienen más variabilidad y tratan de ajustarse al conjunto de entrenamiento y su distribución.</p>
<p>Podemos crear interacciones entre palabras positivas y entre palabras negativas para ayudar al modelo a discernir entre qué palabras están asociadas a textos con reseñas positivas y negativas de forma más fácil. Eliminar palabras con coeficientes muy cercanos a cero, o agruparlas en un grupo adicional.</p>
<p>*<strong>Pregunta 2 </strong>: Obtén los coeficientes de los dos modelos que comparaste arriba. Compara los coeficientes más negativos y más positivos de cada modelo. ¿Cuáles tienen valores más grandes en valor absoluto? ¿Por qué? ¿Tiene sentido cuáles palabras tienen coeficiente positivo y cuáles negativo?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#por ejemplo:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>coefs_baja <span class="ot">&lt;-</span> flujo_textos <span class="sc">|&gt;</span>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>coefs_alta <span class="ot">&lt;-</span> flujo_textos_alta <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>coefs_2mod <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coefs_baja, coefs_alta) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tipo =</span> <span class="fu">ifelse</span>(penalty <span class="sc">&lt;</span> <span class="fl">0.0001</span>, <span class="st">"coef_reg_baja"</span>, <span class="st">"coef_reg_alta"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, tipo, estimate) <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> tipo, <span class="at">values_from =</span> estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por ejemplo, contrasta los siguientes dos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>coefs_2mod <span class="sc">|&gt;</span>  <span class="fu">mutate</span>(<span class="at">coef_reg_baja =</span> <span class="fu">abs</span>(coef_reg_baja)) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(coef_reg_baja)) <span class="sc">|&gt;</span> <span class="fu">select</span>(term, coef_reg_baja)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,001 × 2
   term                   coef_reg_baja
   &lt;chr&gt;                          &lt;dbl&gt;
 1 (Intercept)                    0.392
 2 tf_texto_sethe                 0.321
 3 tf_texto_deputy                0.291
 4 tf_texto_apollo                0.283
 5 tf_texto_bilko                 0.260
 6 tf_texto_friend's              0.252
 7 tf_texto_mario                 0.246
 8 tf_texto_bowfinger             0.224
 9 tf_texto_traveling             0.224
10 tf_texto_embarrassment         0.218
# … with 5,991 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>coefs_2mod <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">coef_reg_alta =</span> <span class="fu">abs</span>(coef_reg_alta)) <span class="sc">|&gt;</span>  <span class="fu">arrange</span>(<span class="fu">desc</span>(coef_reg_alta)) <span class="sc">|&gt;</span> <span class="fu">select</span>(term, coef_reg_alta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,001 × 2
   term                 coef_reg_alta
   &lt;chr&gt;                        &lt;dbl&gt;
 1 (Intercept)                 0.477 
 2 tf_texto_bad                0.113 
 3 tf_texto_wonderfully        0.112 
 4 tf_texto_worst              0.109 
 5 tf_texto_mess               0.104 
 6 tf_texto_awful              0.101 
 7 tf_texto_refreshing         0.101 
 8 tf_texto_waste              0.0948
 9 tf_texto_wasted             0.0932
10 tf_texto_boring             0.0908
# … with 5,991 more rows</code></pre>
</div>
</div>
<p>Los coeficientes del modelo con menor regularización son más grandes en comparación con los coeficientes del modelo con mayor regularización. Por otro lado, el top 10 de ambos coeficientes no es el mismo, además de que no tiene sentido en el modelo con menor regularización que los coeficientes con mayor valor sean palabras que no detectan sentimiento, cosa que sí sucede con el modelo con mayor regularización.</p>
<p><strong>Pregunta 3 </strong>: Grafica coeficientes de un modelo contra los del otro modelo (agrega una recta y=x). ¿Cómo describes los patrones que ves en esa gŕafica?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(coefs_2mod<span class="sc">$</span>coef_reg_baja[<span class="sc">-</span><span class="dv">1</span>], coefs_2mod<span class="sc">$</span>coef_reg_alta[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">+</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Coeficientes regularizacion baja'</span>) <span class="sc">+</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Coeficientes regularizacion alta'</span>) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tarea-4_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Pregunta 4 </strong> (opcional) Clasifica a un texto como “positivo” cuando tenga una predicción digamos mayor a 0.7, y negativo cuando tiene una predicción menor a 0.3. ¿Qué tan bien coincide esta clasificación con las verdaderas etiquetas? ¿Qué tan bien coincide si clasificas como positiva una reseña cuando su predicción es mayor a 0.5? Por ejemplo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>preds_alta_reg_test <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">clas_pos =</span> .pred <span class="sc">&gt;</span> <span class="fl">0.7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clas_pos) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">prop_positivos =</span> <span class="fu">mean</span>(polaridad_num))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  clas_pos prop_positivos
  &lt;lgl&gt;             &lt;dbl&gt;
1 FALSE             0.402
2 TRUE              0.941</code></pre>
</div>
</div>
<p>Cuando clasificamos un texto como positivo si su predicción es mayor a 0.7, tenemos una mayor proporción de aciertos que de fallos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>preds_alta_reg_test <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">clas_neg =</span> .pred <span class="sc">&lt;</span> <span class="fl">0.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clas_neg) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">prop_positivos =</span> <span class="fu">mean</span>(polaridad_num))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  clas_neg prop_positivos
  &lt;lgl&gt;             &lt;dbl&gt;
1 FALSE            0.585 
2 TRUE             0.0577</code></pre>
</div>
</div>
<p>En cambio, si clasificamos como reseña negativa para valores menores a 0.3, la proporción de positivos que clasificamos erróneamente es mayor.</p>
<p><strong>Nota: este problema se resuelve más apropiadamente usando regresión logística, donde intentaremos estimar probabilidades de que una reseña sea positiva o negativa dada su contenido</strong></p>
</section>
<section id="afinando-parámetros" class="level2">
<h2 class="anchored" data-anchor-id="afinando-parámetros">Afinando parámetros</h2>
<p>Veremos cómo seleccionar ahora parámetros óptimos de regularización. Podemos también probar con un número diferente de tokens generados. Alteramos nuestra receta:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>receta_polaridad <span class="ot">&lt;-</span> <span class="fu">recipe</span>(polaridad_num <span class="sc">~</span> ., textos_ent) <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">texto =</span> <span class="fu">str_remove_all</span>(texto, <span class="st">"[_()]"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">texto =</span> <span class="fu">str_remove_all</span>(texto, <span class="st">"[0-9]*"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenize</span>(texto) <span class="sc">|&gt;</span> <span class="co"># separar por palabras</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_stopwords</span>(texto) <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">#### en esta no fijamos el número de tokens:</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenfilter</span>(texto, <span class="at">max_tokens =</span> <span class="fu">tune</span>(<span class="st">"max_tokens"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tf</span>(texto, <span class="at">weight_scheme =</span> <span class="st">"binary"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.logical), as.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Definimos nuestro modelo. Nótese que el término de penalty tampoco está fijo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>lasso_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>office_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(receta_polaridad) <span class="sc">|&gt;</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_spec) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Y creamos combinaciones de valores para probar:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nota: ajustar los límites aquí dependiendo de los resultados:</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>valores_afinar <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">penalty =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="fu">tibble</span>(<span class="at">max_tokens =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">3000</span>, <span class="dv">6000</span>, <span class="dv">9000</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este caso, los datos de entrenamiento de nuestro split se usan para ajustar el modelo, y cada modelo se evaluá con el conjunto de validación:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>evaluar_lasso <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  office_wf,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> textos_split,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> valores_afinar,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(evaluar_lasso) <span class="sc">|&gt;</span> </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> penalty, <span class="at">y =</span> mean, <span class="at">colour =</span> <span class="fu">factor</span>(max_tokens), </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">group =</span> max_tokens)) <span class="sc">+</span> </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tarea-4_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Pregunta 5</strong>: ¿Qué pasa con valores grandes de <em>penalty</em> (lambda)? ¿Por qué el valor del error no cambia para valores grandes? ¿Qué modelos son los seleccionados para valores grandes de lambda?</p>
<p>Para valores de penalización grandes nuestro modelo restringe los coeficientes con mayor <em>rudeza</em>, lo que hace que no se alejen tanto del valor de referencia 0 (cero). Si hacemos que los coeficientes sean tan pequeños, entonces caeremos en error de sesgo, ajustando cada vez más una recta y=0.</p>
<p><strong>Pregunta 6</strong>: ¿Por qué el error de modelos con baja regularización es más grande que los modelos más regularizados? ¿Su problema es sesgo o por varianza?</p>
<p>El error es mayor porque los coeficientes varían mucho, tratandose de ajustar a los valores de entrenamiento observados, entonces tenemos un problema de varianza.</p>
<p><strong>Pregunta 7</strong>: Considera que el valor de <em>max_tokens</em> igual a 100 lo puedes descalificar. ¿Es por problemas de sesgo o varianza? ¿Por qué para valores grandes de regularización se desempeña igual que los otros modelos más grandes?</p>
<p>El modelo con <em>max_tokens</em> igual a 100 carece tanto de sesgo como de varianza. Al aumentar la regularización hasta un valor óptimo, el error disminuye ligeramente, sin embargo no disminuye lo suficiente como para considerarlo como un buen predictor. La diferencia entre el error con poca regularización y con mucha regularización es muy poca, entonces podemos decir que carece de ambas.</p>
<p>Seleccionaremos nuestro modelo final tomando el que dio el mejor valor de el error:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>minimo_mae <span class="ot">&lt;-</span> evaluar_lasso <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="st">"rmse"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># finalizar modelo con hiperparámetros seleccionados</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>modelo_final <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(office_wf, minimo_mae) <span class="sc">|&gt;</span> <span class="fu">fit</span>(textos_ent)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># tabla de coeficientes</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>modelo_final <span class="sc">|&gt;</span> <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(estimate <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(estimate)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 594 × 3
   term                   estimate penalty
   &lt;chr&gt;                     &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)               0.460  0.0251
 2 tf_texto_unimaginative   -0.213  0.0251
 3 tf_texto_degenerates     -0.213  0.0251
 4 tf_texto_lang             0.184  0.0251
 5 tf_texto_uncut            0.152  0.0251
 6 tf_texto_vikings         -0.134  0.0251
 7 tf_texto_sloppy          -0.127  0.0251
 8 tf_texto_mess            -0.123  0.0251
 9 tf_texto_jeopardy        -0.121  0.0251
10 tf_texto_fictional        0.121  0.0251
# … with 584 more rows</code></pre>
</div>
</div>
<p><strong>Pregunta 8</strong>: compara el número original de columnas y cuántas de ellas utiliza tu modelo. Examina los coeficientes de la tabla de arriba. ¿Ves algún patrón entre coeficientes positivos y negativos?</p>
<p>Nuestro modelo usa 594 columnas en total. Los coeficientes con mayor importancia no son los sentimientos, sin embargo las palabras con mayor relevancia son los sentimientos positivos y luego los sentimientos negativos.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>